<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Test - Dark Mode & QR</title>
    <link rel="stylesheet" href="../assets/css/tailwind.css">
    <link rel="stylesheet" href="../assets/css/system.css">
    <link rel="stylesheet" href="../admin/css/visitor-passes.css">
</head>
<body class="p-8 bg-gray-50">
    <h1 class="text-2xl font-bold mb-4">Debug Test Page</h1>
    
    <div class="space-y-8">
        <!-- Dark Mode Toggle Test -->
        <section class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">Dark Mode Toggle Test</h2>
            <div class="flex items-center gap-4">
                <button 
                    id="darkModeToggle" 
                    role="switch"
                    aria-checked="false"
                    aria-label="Toggle dark mode"
                    class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 border-2 border-gray-300">
                    <span id="darkModeThumb" class="inline-block h-5 w-5 transform rounded-full bg-white shadow-lg transition-transform duration-200 ease-in-out translate-x-0.5"></span>
                </button>
                <span class="text-sm font-medium text-gray-600">Dark Mode</span>
                <span id="status" class="text-sm text-gray-500">Status: Light</span>
            </div>
            <div class="mt-4">
                <p class="text-sm text-gray-600">localStorage value: <span id="storageValue">-</span></p>
                <p class="text-sm text-gray-600">Body class: <span id="bodyClass">-</span></p>
            </div>
        </section>

        <!-- QR Code Test -->
        <section class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">QR Code Click Test</h2>
            <p class="mb-4 text-sm text-gray-600">Click the QR code below - it should open in a modal:</p>
            <img 
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAFUlEQVR42mNk+M9Qz0AEYBxVSF+FABJADveWkH6oAAAAAElFTkSuQmCC" 
                alt="Test QR" 
                class="w-32 h-32 qr-clickable border-2 border-gray-300 rounded"
                style="image-rendering: pixelated;">
            <p class="mt-2 text-xs text-gray-500">This is a test QR code</p>
        </section>

        <!-- Console Log -->
        <section class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">Console Log</h2>
            <div id="console" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-xs h-48 overflow-auto"></div>
        </section>
    </div>

    <script>
        // Intercept console.log
        const consoleDiv = document.getElementById('console');
        const originalLog = console.log;
        const originalError = console.error;
        
        function addToConsole(msg, type = 'log') {
            const line = document.createElement('div');
            line.className = type === 'error' ? 'text-red-400' : 'text-green-400';
            line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            consoleDiv.appendChild(line);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            addToConsole(args.join(' '), 'log');
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            addToConsole(args.join(' '), 'error');
            originalError.apply(console, args);
        };
        
        // Test dark mode toggle
        const toggle = document.getElementById('darkModeToggle');
        const thumb = document.getElementById('darkModeThumb');
        const status = document.getElementById('status');
        const storageValue = document.getElementById('storageValue');
        const bodyClass = document.getElementById('bodyClass');
        
        function updateStatus() {
            const isDark = document.body.classList.contains('dark');
            status.textContent = `Status: ${isDark ? 'Dark' : 'Light'}`;
            storageValue.textContent = localStorage.getItem('adminDarkMode') || 'null';
            bodyClass.textContent = document.body.className;
        }
        
        function enableDarkMode() {
            console.log('Enabling dark mode...');
            document.body.classList.add('dark');
            toggle.classList.add('bg-slate-700');
            toggle.classList.remove('bg-gray-200');
            thumb.classList.add('translate-x-5');
            thumb.classList.remove('translate-x-0.5');
            updateStatus();
        }
        
        function enableLightMode() {
            console.log('Enabling light mode...');
            document.body.classList.remove('dark');
            toggle.classList.remove('bg-slate-700');
            toggle.classList.add('bg-gray-200');
            thumb.classList.remove('translate-x-5');
            thumb.classList.add('translate-x-0.5');
            updateStatus();
        }
        
        // Initialize
        const currentTheme = localStorage.getItem('adminDarkMode') || 'light';
        console.log('Initial theme:', currentTheme);
        
        if (currentTheme === 'dark') {
            enableDarkMode();
        } else {
            enableLightMode();
        }
        
        // Toggle on click
        toggle.addEventListener('click', () => {
            console.log('Toggle clicked!');
            const isDark = document.body.classList.contains('dark');
            
            if (isDark) {
                enableLightMode();
                localStorage.setItem('adminDarkMode', 'light');
            } else {
                enableDarkMode();
                localStorage.setItem('adminDarkMode', 'dark');
            }
        });
        
        console.log('Dark mode toggle initialized');
        console.log('Toggle element:', toggle);
        console.log('Thumb element:', thumb);
    </script>
    
    <!-- Load QR modal script -->
    <script src="../admin/js/qr-modal.js"></script>
    <script>
        console.log('QR modal script loaded');
        console.log('openQRZoom function:', typeof window.openQRZoom);
        console.log('closeQRZoom function:', typeof window.closeQRZoom);
        
        // Test QR clickable elements
        setTimeout(() => {
            const qrElements = document.querySelectorAll('.qr-clickable');
            console.log('QR clickable elements found:', qrElements.length);
        }, 1000);
    </script>
</body>
</html>
