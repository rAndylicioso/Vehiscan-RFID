<!DOCTYPE html>
<html>
<head>
    <title>Cookie & Session Inspector</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
        .box { background: #252526; padding: 15px; margin: 10px 0; border-radius: 5px; border: 1px solid #3e3e42; }
        h1, h2 { color: #4ec9b0; }
        .cookie { background: #2d2d30; padding: 10px; margin: 5px 0; border-left: 3px solid #007acc; }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #dcdcaa; }
        button { background: #0e639c; color: white; border: none; padding: 10px 15px; border-radius: 3px; cursor: pointer; margin: 5px; }
        button:hover { background: #1177bb; }
        pre { background: #1e1e1e; padding: 10px; border-radius: 3px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        td, th { padding: 8px; text-align: left; border-bottom: 1px solid #3e3e42; }
        th { color: #4ec9b0; }
    </style>
</head>
<body>
    <h1>üîç Cookie & Session Inspector</h1>
    
    <div class="box">
        <h2>Browser Cookies</h2>
        <div id="cookies"></div>
    </div>
    
    <div class="box">
        <h2>Server Sessions (via AJAX)</h2>
        <button onclick="checkSessions()">Check All Sessions</button>
        <div id="sessions"></div>
    </div>
    
    <div class="box">
        <h2>Login Status</h2>
        <div id="login-status"></div>
    </div>
    
    <div class="box">
        <h2>Actions</h2>
        <button onclick="window.location.href='../auth/login.php'">Go to Login Page</button>
        <button onclick="window.location.href='../admin/admin_panel.php'">Try Admin Panel</button>
        <button onclick="clearAllSessions()">Clear All Sessions</button>
    </div>

    <script>
        window.addEventListener('load', () => {
            showCookies();
            checkSessions();
        });
        
        function showCookies() {
            const cookies = document.cookie.split(';');
            const cookiesDiv = document.getElementById('cookies');
            
            if (cookies.length === 0 || (cookies.length === 1 && cookies[0].trim() === '')) {
                cookiesDiv.innerHTML = '<div class="error">No cookies found</div>';
                return;
            }
            
            let html = '<table><tr><th>Cookie Name</th><th>Value</th></tr>';
            cookies.forEach(cookie => {
                const [name, value] = cookie.trim().split('=');
                const isSessionCookie = name.includes('vehiscan');
                html += '<tr><td>' + (isSessionCookie ? '<strong class="success">' + name + '</strong>' : name) + 
                        '</td><td>' + value.substring(0, 50) + (value.length > 50 ? '...' : '') + '</td></tr>';
            });
            html += '</table>';
            
            // Highlight vehiscan cookies
            const vehiscanCookies = cookies.filter(c => c.includes('vehiscan'));
            if (vehiscanCookies.length > 0) {
                html += '<div class="success" style="margin-top:10px;">‚úì Found ' + vehiscanCookies.length + ' Vehiscan session cookie(s)</div>';
            } else {
                html += '<div class="error" style="margin-top:10px;">‚úó No Vehiscan session cookies found</div>';
            }
            
            cookiesDiv.innerHTML = html;
        }
        
        function checkSessions() {
            const sessionsDiv = document.getElementById('sessions');
            const statusDiv = document.getElementById('login-status');
            
            sessionsDiv.innerHTML = '<div class="warning">Checking sessions...</div>';
            
            fetch('../_diagnostics/session_debug_enhanced.php')
                .then(response => response.text())
                .then(html => {
                    // Parse the HTML to find session info
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    let sessionInfo = '<table><tr><th>Session Type</th><th>Status</th><th>Data</th></tr>';
                    
                    // Check each session type
                    const sessionTypes = [
                        { name: 'Super Admin', cookie: 'vehiscan_superadmin' },
                        { name: 'Admin', cookie: 'vehiscan_admin' },
                        { name: 'Guard', cookie: 'vehiscan_guard' }
                    ];
                    
                    let activeSession = null;
                    
                    sessionTypes.forEach(type => {
                        const hasCookie = document.cookie.includes(type.cookie);
                        const isActive = html.includes(type.name + ': ‚úì LOGGED IN');
                        
                        sessionInfo += '<tr><td>' + type.name + '</td>';
                        sessionInfo += '<td>' + (isActive ? '<span class="success">‚úì Active</span>' : '<span class="error">‚úó Inactive</span>') + '</td>';
                        sessionInfo += '<td>' + (hasCookie ? '<span class="success">Cookie: ' + type.cookie + '</span>' : '<span class="error">No cookie</span>') + '</td></tr>';
                        
                        if (isActive) activeSession = type.name;
                    });
                    
                    sessionInfo += '</table>';
                    sessionsDiv.innerHTML = sessionInfo;
                    
                    // Update login status
                    if (activeSession) {
                        statusDiv.innerHTML = '<div class="success"><strong>‚úì LOGGED IN as ' + activeSession + '</strong></div>';
                    } else {
                        statusDiv.innerHTML = '<div class="error"><strong>‚úó NOT LOGGED IN</strong><br>Please login at <a href="../auth/login.php">login page</a></div>';
                    }
                })
                .catch(error => {
                    sessionsDiv.innerHTML = '<div class="error">Error: ' + error.message + '</div>';
                });
        }
        
        function clearAllSessions() {
            if (!confirm('This will log you out from all sessions. Continue?')) return;
            
            fetch('../auth/logout.php')
                .then(() => {
                    alert('All sessions cleared. Please refresh the page.');
                    location.reload();
                })
                .catch(error => {
                    alert('Error: ' + error.message);
                });
        }
    </script>
</body>
</html>
