<!DOCTYPE html>
<html>
<head>
    <title>Quick Session Test</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .test { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .pass { border-left: 4px solid #28a745; }
        .fail { border-left: 4px solid #dc3545; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 3px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        pre { background: #272822; color: #f8f8f2; padding: 10px; border-radius: 3px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <h1>ðŸ”§ Quick Session Test for Localhost</h1>
    
    <div class="test">
        <h3>Test 1: Session Status</h3>
        <button onclick="testSession()">Check Session</button>
        <div id="session-result"></div>
    </div>
    
    <div class="test">
        <h3>Test 2: Test All Endpoints</h3>
        <button onclick="testAllEndpoints()">Run All Tests</button>
        <div id="endpoints-result"></div>
    </div>
    
    <div class="test">
        <h3>Test 3: Admin Panel Access</h3>
        <button onclick="window.location.href='../admin/admin_panel.php'">Open Admin Panel</button>
    </div>

    <script>
        async function testSession() {
            const resultDiv = document.getElementById('session-result');
            resultDiv.innerHTML = '<p>Testing...</p>';
            
            try {
                const response = await fetch('../_diagnostics/session_debug_enhanced.php');
                const html = await response.text();
                
                if (html.includes('LOGGED IN')) {
                    resultDiv.innerHTML = '<p style="color:green;">âœ“ Session is active!</p>';
                } else {
                    resultDiv.innerHTML = '<p style="color:red;">âœ— No active session. Please <a href="../auth/login.php">login</a>.</p>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<p style="color:red;">Error: ' + error.message + '</p>';
            }
        }
        
        async function testAllEndpoints() {
            const resultDiv = document.getElementById('endpoints-result');
            resultDiv.innerHTML = '<p>Testing all endpoints...</p>';
            
            const endpoints = [
                { name: 'Dashboard', url: '../admin/fetch/fetch_dashboard.php' },
                { name: 'Approvals', url: '../admin/fetch/fetch_approvals.php' },
                { name: 'Employees', url: '../admin/fetch/fetch_employees.php' },
                { name: 'Visitors', url: '../admin/fetch/fetch_visitors.php' },
                { name: 'Logs', url: '../admin/fetch/fetch_logs.php' },
                { name: 'Check Pending', url: '../admin/api/check_pending_approvals.php' },
                { name: 'Check Logs', url: '../admin/api/check_new_logs.php' }
            ];
            
            let results = '<table style="width:100%; border-collapse: collapse;">';
            results += '<tr><th style="text-align:left; padding:8px; border-bottom:1px solid #ddd;">Endpoint</th><th style="text-align:left; padding:8px; border-bottom:1px solid #ddd;">Status</th></tr>';
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint.url);
                    const status = response.status;
                    const color = status === 200 ? 'green' : (status === 403 ? 'red' : 'orange');
                    results += `<tr><td style="padding:8px; border-bottom:1px solid #eee;">${endpoint.name}</td>`;
                    results += `<td style="padding:8px; border-bottom:1px solid #eee; color:${color}; font-weight:bold;">${status} ${status === 200 ? 'âœ“' : status === 403 ? 'âœ— Forbidden' : '?'}</td></tr>`;
                } catch (error) {
                    results += `<tr><td style="padding:8px; border-bottom:1px solid #eee;">${endpoint.name}</td>`;
                    results += `<td style="padding:8px; border-bottom:1px solid #eee; color:red;">Error: ${error.message}</td></tr>`;
                }
            }
            
            results += '</table>';
            resultDiv.innerHTML = results;
        }
        
        // Auto-run tests on load
        window.addEventListener('load', () => {
            testSession();
        });
    </script>
</body>
</html>
